"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{9131:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});var o=r(2115),n=r(7856),c=r.n(n),s=r(2111),a=r(2846);let i=e=>{let{parks:t,onMarkerClick:r,map:n,mapLoaded:i}=e,l=(0,o.useRef)(null),u="parks-cluster-source",d="parks-clusters",p="parks-cluster-count",y="parks-unclustered";return(0,o.useEffect)(()=>{if(!n||!i||!t||0===t.length)return;if(!n.isStyleLoaded())return void n.once("styledata",()=>{t&&t.length});let e={type:"FeatureCollection",features:t.map(e=>{let t=(0,s.bW)(e.agency),r=a.$.markerColors[t]||a.$.markerColors.FEDERAL;return{type:"Feature",properties:{id:e.id,name:e.name,agency:e.agency,normalizedAgency:t,markerColor:r,state:e.state,latitude:e.latitude,longitude:e.longitude,distance:e.distance,...e},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}}})},o=e=>{try{return void 0!==n.getSource(e)}catch(e){return!1}},f=e=>{try{return void 0!==n.getLayer(e)}catch(e){return!1}};if(o(u))try{let t=n.getSource(u);t&&"function"==typeof t.setData&&t.setData(e)}catch(e){console.error("Error updating source data:",e);return}else try{n.addSource(u,{type:"geojson",data:e,cluster:!0,clusterMaxZoom:12,clusterRadius:50})}catch(e){console.error("Error adding source:",e);return}if(!f(d))try{n.addLayer({id:d,type:"circle",source:u,filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#4a7c2f",10,"#3a6c1f",50,"#2d5016"],"circle-radius":["step",["get","point_count"],20,10,30,50,40],"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.8}})}catch(e){console.error("Error adding cluster layer:",e);return}if(!f(p))try{n.addLayer({id:p,type:"symbol",source:u,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"}})}catch(e){console.error("Error adding cluster count layer:",e);return}if(!f(y))try{n.addLayer({id:y,type:"circle",source:u,filter:["!",["has","point_count"]],paint:{"circle-color":["get","markerColor"],"circle-radius":10,"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.8}})}catch(e){console.error("Error adding unclustered layer:",e);return}let g=e=>{let t=n.queryRenderedFeatures(e.point,{layers:[d]});if(0===t.length)return;let a=t[0].properties.cluster_id,i=t[0].properties.point_count;((e,t,a)=>{try{f("spiderfy-lines")&&n.removeLayer("spiderfy-lines"),f("spiderfy-layer")&&n.removeLayer("spiderfy-layer"),o("spiderfy-source")&&n.removeSource("spiderfy-source"),o("spiderfy-lines-source")&&n.removeSource("spiderfy-lines-source")}catch(e){}let i=n.getSource(u);i&&"function"==typeof i.getClusterLeaves&&i.getClusterLeaves(e,a,0,(a,u)=>{if(a||!u||0===u.length||u.length<=10){"function"==typeof i.getClusterExpansionZoom&&i.getClusterExpansionZoom(e,(e,r)=>{e||n.easeTo({center:t,zoom:r})});return}let d=2*Math.PI/u.length,p=u.map((e,r)=>{let o=r*d,n=.003*Math.cos(o),c=.003*Math.sin(o);return{type:"Feature",properties:e.properties,geometry:{type:"Point",coordinates:[t[0]+n,t[1]+c]}}}),y="spiderfy-source",g="spiderfy-layer",m="spiderfy-lines";f(m)&&n.removeLayer(m),f(g)&&n.removeLayer(g),o(y)&&n.removeSource(y),n.addSource(y,{type:"geojson",data:{type:"FeatureCollection",features:p}});let v=p.map(e=>({type:"Feature",geometry:{type:"LineString",coordinates:[t,e.geometry.coordinates]}}));n.addSource("spiderfy-lines-source",{type:"geojson",data:{type:"FeatureCollection",features:v}}),n.addLayer({id:m,type:"line",source:"spiderfy-lines-source",paint:{"line-color":"#666","line-width":1.5,"line-opacity":.5}}),n.addLayer({id:g,type:"circle",source:y,paint:{"circle-color":"#4a7c2f","circle-radius":10,"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.9}});let h=e=>{let t=n.queryRenderedFeatures(e.point,{layers:[g]});if(t.length>0){let e=t[0].properties,a=t[0].geometry.coordinates,i={id:e.id,name:e.name,agency:e.agency,state:e.state,latitude:e.latitude||a[1],longitude:e.longitude||a[0],distance:e.distance,...e};l.current&&l.current.remove();let u=new(c()).Popup({offset:25,closeOnClick:!1,closeButton:!0}).setLngLat(a).setHTML('\n                <div class="popup-content" style="min-width: 200px;">\n                  <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">'.concat(i.name||"Unnamed Park","</h3>\n                  ").concat(i.distance?'<p style="margin: 4px 0; font-size: 14px;"><strong>Distance:</strong> '.concat(i.distance.toFixed(1)," miles</p>"):"",'\n                  <p style="margin: 4px 0; font-size: 14px;"><strong>State:</strong> ').concat(i.state||"N/A",'</p>\n                  <p style="margin: 4px 0; font-size: 14px;"><strong>Type:</strong> ').concat((0,s.uf)(i.agency),'</p>\n                  <button \n                    class="detail-button" \n                    data-park-id="').concat(i.id,'"\n                    style="\n                      margin-top: 8px;\n                      padding: 8px 16px;\n                      background-color: #007bff;\n                      color: white;\n                      border: none;\n                      border-radius: 4px;\n                      cursor: pointer;\n                      font-size: 14px;\n                      width: 100%;\n                    "\n                  >View Details</button>\n                </div>\n              ')).addTo(n);l.current=u,u.getElement().addEventListener("click",e=>{(e.target.classList.contains("detail-button")||e.target.closest(".detail-button"))&&(e.stopPropagation(),l.current&&(l.current.remove(),l.current=null),r&&r(i))});try{f(m)&&n.removeLayer(m),f(g)&&n.removeLayer(g),o(y)&&n.removeSource(y),o("spiderfy-lines-source")&&n.removeSource("spiderfy-lines-source"),n.off("click",g,h),n.off("mouseenter",g),n.off("mouseleave",g)}catch(e){console.warn("Error cleaning up spiderfy on click:",e)}}};n.on("click",g,h),n.on("mouseenter",g,()=>{n.getCanvas().style.cursor="pointer"}),n.on("mouseleave",g,()=>{n.getCanvas().style.cursor=""});let k=null,x=()=>{k&&clearTimeout(k),k=setTimeout(()=>{try{f(m)&&n.removeLayer(m),f(g)&&n.removeLayer(g),o(y)&&n.removeSource(y),o("spiderfy-lines-source")&&n.removeSource("spiderfy-lines-source"),n.off("click",g,h),n.off("mouseenter",g),n.off("mouseleave",g)}catch(e){console.warn("Error cleaning up spiderfy:",e)}},100)};n.once("move",x),n.once("zoom",x),n.once("click",x)})})(a,t[0].geometry.coordinates,i)},m=e=>{let t=n.queryRenderedFeatures(e.point,{layers:[y]});if(t.length>0){let e=t[0].properties,o=t[0].geometry.coordinates,a={id:e.id,name:e.name,agency:e.agency,state:e.state,latitude:e.latitude||o[1],longitude:e.longitude||o[0],distance:e.distance,...e};l.current&&l.current.remove();let i=new(c()).Popup({offset:25,closeOnClick:!1,closeButton:!0}).setLngLat(o).setHTML('\n            <div class="popup-content" style="min-width: 200px;">\n              <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">'.concat(a.name||"Unnamed Park","</h3>\n              ").concat(a.distance?'<p style="margin: 4px 0; font-size: 14px;"><strong>Distance:</strong> '.concat(a.distance.toFixed(1)," miles</p>"):"",'\n              <p style="margin: 4px 0; font-size: 14px;"><strong>State:</strong> ').concat(a.state||"N/A",'</p>\n              <p style="margin: 4px 0; font-size: 14px;"><strong>Type:</strong> ').concat((0,s.uf)(a.agency),'</p>\n              <button \n                class="detail-button" \n                data-park-id="').concat(a.id,'"\n                style="\n                  margin-top: 8px;\n                  padding: 8px 16px;\n                  background-color: #007bff;\n                  color: white;\n                  border: none;\n                  border-radius: 4px;\n                  cursor: pointer;\n                  font-size: 14px;\n                  width: 100%;\n                "\n                onmouseover="this.style.backgroundColor=\'#0056b3\'"\n                onmouseout="this.style.backgroundColor=\'#007bff\'"\n              >View Details</button>\n            </div>\n          ')).addTo(n);l.current=i,i.getElement().addEventListener("click",e=>{(e.target.classList.contains("detail-button")||e.target.closest(".detail-button"))&&(e.stopPropagation(),l.current&&(l.current.remove(),l.current=null),r&&r(a))})}};return n.on("click",d,g),n.on("click",y,m),n.on("mouseenter",d,()=>{n.getCanvas().style.cursor="pointer"}),n.on("mouseleave",d,()=>{n.getCanvas().style.cursor=""}),n.on("mouseenter",y,()=>{n.getCanvas().style.cursor="pointer"}),n.on("mouseleave",y,()=>{n.getCanvas().style.cursor=""}),()=>{if(n&&i)try{n.off("click",d,g),n.off("click",y,m),n.off("mouseenter",d),n.off("mouseleave",d),n.off("mouseenter",y),n.off("mouseleave",y),f(d)&&n.removeLayer(d),f(p)&&n.removeLayer(p),f(y)&&n.removeLayer(y),o(u)&&n.removeSource(u)}catch(e){console.warn("Error during cleanup:",e)}}},[n,i,t,r]),(0,o.useEffect)(()=>()=>{l.current&&(l.current.remove(),l.current=null)},[]),null}}}]);
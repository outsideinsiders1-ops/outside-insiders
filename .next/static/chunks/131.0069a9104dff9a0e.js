"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{9131:(e,r,t)=>{t.r(r),t.d(r,{default:()=>i});var o=t(2115),c=t(2111),a=t(2846);let i=e=>{let{parks:r,onMarkerClick:t,map:i,mapLoaded:s}=e,n="parks-cluster-source",l="parks-clusters",u="parks-cluster-count",y="parks-unclustered";return(0,o.useEffect)(()=>{if(!i||!s||!r||0===r.length)return;let e={type:"FeatureCollection",features:r.map(e=>{let r=(0,c.bW)(e.agency),t=a.$.markerColors[r]||a.$.markerColors.FEDERAL;return{type:"Feature",properties:{id:e.id,name:e.name,agency:e.agency,normalizedAgency:r,markerColor:t,state:e.state,latitude:e.latitude,longitude:e.longitude,distance:e.distance,...e},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}}})};i.getSource(n)?i.getSource(n).setData(e):i.addSource(n,{type:"geojson",data:e,cluster:!0,clusterMaxZoom:14,clusterRadius:50}),i.getLayer(l)||i.addLayer({id:l,type:"circle",source:n,filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#4a7c2f",10,"#3a6c1f",50,"#2d5016"],"circle-radius":["step",["get","point_count"],20,10,30,50,40],"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.8}}),i.getLayer(u)||i.addLayer({id:u,type:"symbol",source:n,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"}}),i.getLayer(y)||i.addLayer({id:y,type:"circle",source:n,filter:["!",["has","point_count"]],paint:{"circle-color":["get","markerColor"],"circle-radius":10,"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.8}});let o=e=>{let r=i.queryRenderedFeatures(e.point,{layers:[l]});if(0===r.length)return;let o=r[0].properties.cluster_id,c=r[0].properties.point_count;((e,r,o)=>{try{i.getLayer("spiderfy-lines")&&i.removeLayer("spiderfy-lines"),i.getLayer("spiderfy-layer")&&i.removeLayer("spiderfy-layer"),i.getSource("spiderfy-source")&&i.removeSource("spiderfy-source"),i.getSource("spiderfy-lines-source")&&i.removeSource("spiderfy-lines-source")}catch(e){}i.getSource(n).getClusterLeaves(e,o,0,(o,c)=>{if(o||!c||0===c.length||c.length<=10)return void i.getSource(n).getClusterExpansionZoom(e,(e,t)=>{e||i.easeTo({center:r,zoom:t})});let a=2*Math.PI/c.length,s=c.map((e,t)=>{let o=t*a,c=.003*Math.cos(o),i=.003*Math.sin(o);return{type:"Feature",properties:e.properties,geometry:{type:"Point",coordinates:[r[0]+c,r[1]+i]}}}),l="spiderfy-source",u="spiderfy-layer",y="spiderfy-lines";i.getLayer(y)&&i.removeLayer(y),i.getLayer(u)&&i.removeLayer(u),i.getSource(l)&&i.removeSource(l),i.addSource(l,{type:"geojson",data:{type:"FeatureCollection",features:s}});let d=s.map(e=>({type:"Feature",geometry:{type:"LineString",coordinates:[r,e.geometry.coordinates]}}));i.addSource("spiderfy-lines-source",{type:"geojson",data:{type:"FeatureCollection",features:d}}),i.addLayer({id:y,type:"line",source:"spiderfy-lines-source",paint:{"line-color":"#666","line-width":1.5,"line-opacity":.5}}),i.addLayer({id:u,type:"circle",source:l,paint:{"circle-color":"#4a7c2f","circle-radius":10,"circle-stroke-width":3,"circle-stroke-color":"#fff","circle-opacity":.9}});let p=e=>{let r=i.queryRenderedFeatures(e.point,{layers:[u]});if(r.length>0&&t){let e=r[0].properties;t({id:e.id,name:e.name,agency:e.agency,state:e.state,latitude:e.latitude||r[0].geometry.coordinates[1],longitude:e.longitude||r[0].geometry.coordinates[0],distance:e.distance,...e});try{i.getLayer(y)&&i.removeLayer(y),i.getLayer(u)&&i.removeLayer(u),i.getSource(l)&&i.removeSource(l),i.getSource("spiderfy-lines-source")&&i.removeSource("spiderfy-lines-source"),i.off("click",u,p),i.off("mouseenter",u),i.off("mouseleave",u)}catch(e){console.warn("Error cleaning up spiderfy on click:",e)}}};i.on("click",u,p),i.on("mouseenter",u,()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave",u,()=>{i.getCanvas().style.cursor=""});let f=null,g=()=>{f&&clearTimeout(f),f=setTimeout(()=>{try{i.getLayer(y)&&i.removeLayer(y),i.getLayer(u)&&i.removeLayer(u),i.getSource(l)&&i.removeSource(l),i.getSource("spiderfy-lines-source")&&i.removeSource("spiderfy-lines-source"),i.off("click",u,p),i.off("mouseenter",u),i.off("mouseleave",u)}catch(e){console.warn("Error cleaning up spiderfy:",e)}},100)};i.once("move",g),i.once("zoom",g),i.once("click",g)})})(o,r[0].geometry.coordinates,c)},d=e=>{let r=i.queryRenderedFeatures(e.point,{layers:[y]});if(r.length>0&&t){let e=r[0].properties;t({id:e.id,name:e.name,agency:e.agency,state:e.state,latitude:e.latitude||r[0].geometry.coordinates[1],longitude:e.longitude||r[0].geometry.coordinates[0],distance:e.distance,...e})}};return i.on("click",l,o),i.on("click",y,d),i.on("mouseenter",l,()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave",l,()=>{i.getCanvas().style.cursor=""}),i.on("mouseenter",y,()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave",y,()=>{i.getCanvas().style.cursor=""}),()=>{i.off("click",l,o),i.off("click",y,d),i.off("mouseenter",l),i.off("mouseleave",l),i.off("mouseenter",y),i.off("mouseleave",y),i.getLayer(l)&&i.removeLayer(l),i.getLayer(u)&&i.removeLayer(u),i.getLayer(y)&&i.removeLayer(y),i.getSource(n)&&i.removeSource(n)}},[i,s,r,t]),null}}}]);
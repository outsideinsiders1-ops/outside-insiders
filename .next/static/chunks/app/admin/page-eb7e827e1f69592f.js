(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{4180:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var i=t(5155),r=t(2115),a=t(1993);t(6255);var l=t(5704);let n=l.env.NEXT_PUBLIC_SUPABASE_URL||"",o=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",c=n&&o?(0,a.UU)(n,o):null,d=function(){let[e,s]=(0,r.useState)("scraper"),[t,a]=(0,r.useState)([]),[l,n]=(0,r.useState)([]),[o,d]=(0,r.useState)([]),[p,u]=(0,r.useState)([]),[h,x]=(0,r.useState)(!0),[g,m]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[S,b]=(0,r.useState)(""),[k,P]=(0,r.useState)("state"),[N,C]=(0,r.useState)(!1),[A,_]=(0,r.useState)(null),[w,D]=(0,r.useState)(null),[T,F]=(0,r.useState)({counties:0,cities:0}),[U,E]=(0,r.useState)(null),[q,I]=(0,r.useState)("State Agency"),[O,L]=(0,r.useState)(!1),[M,z]=(0,r.useState)(null),[R,B]=(0,r.useState)(null);(0,r.useEffect)(()=>{G()},[]);let G=async()=>{if(!c){console.error("Supabase client not initialized"),x(!1);return}x(!0);try{let{data:e,error:s}=await c.from("geographic_entities").select("id, name, state_code").eq("entity_type","state").order("name");if(s)throw s;e&&e.length>0&&a(e)}catch(e){console.error("Error loading states:",e)}finally{x(!1)}},J=async e=>{if(c)try{let{data:s,error:t}=await c.from("geographic_entities").select("id, name, metro_id").eq("entity_type","metro").eq("state_code",e).order("name");if(t)throw t;s&&s.length>0?n(s):n([])}catch(e){console.error("Error loading metros:",e),n([])}},W=async e=>{if(c)try{let{data:s,error:t}=await c.from("geographic_entities").select("id, name").eq("entity_type","county").eq("state_code",e).order("name");if(t)throw t;s&&s.length>0?d(s):d([])}catch(e){console.error("Error loading counties:",e),d([])}},H=async e=>{if(c)try{let{data:s,error:t}=await c.from("geographic_entities").select("id, name").eq("entity_type","city").eq("state_code",e).order("name");if(t)throw t;s&&s.length>0?u(s):u([])}catch(e){console.error("Error loading cities:",e),u([])}},X=async(e,s)=>{try{if(!c)return;let{data:t}=await c.from("geographic_entities").select("id").eq("entity_type","county").eq("metro_id",e).eq("state_code",s),{data:i}=await c.from("geographic_entities").select("id").eq("entity_type","city").eq("metro_id",e).eq("state_code",s);F({counties:t?t.length:0,cities:i?i.length:0})}catch(e){console.error("Error loading metro details:",e),F({counties:0,cities:0})}},Z=async(e,s)=>{m(e),y(""),v(""),b(""),F({counties:0,cities:0}),s?(await J(s),await W(s),await H(s)):(n([]),d([]),u([]))},K=async e=>{if(y(e),e){let s=l.find(s=>s.name===e),i=t.find(e=>e.name===g);s&&i&&await X(s.metro_id,i.state_code)}else F({counties:0,cities:0})},Q=e=>{P(e),y(""),v(""),b(""),F({counties:0,cities:0})},Y=async()=>{let e={type:k,state:g};if("state"===k){if(!g)return void D("Please select a state");e.name=g}else if("metro"===k){if(!j)return void D("Please select a metro area");let s=l.find(e=>e.name===j);e.name=j,e.metroId=null==s?void 0:s.metro_id}else if("county"===k){if(!f)return void D("Please select a county");e.name=f}else if("city"===k){if(!S)return void D("Please select a city");e.name=S}C(!0),D(null),_(null);try{let s=await fetch("/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await s.json();s.ok&&t.success?_(t):D(t.error||"Scraping failed")}catch(e){D("Error: ".concat(e.message))}finally{C(!1)}},V=async()=>{if(!U)return void B("Please select a file");if(!c)return void B("Supabase client not initialized");L(!0),B(null),z(null);let e=null;try{let s="".concat(Date.now(),"-").concat(U.name);e="uploads/".concat(s),console.log("Uploading ".concat(U.name," (").concat((U.size/1024/1024).toFixed(2)," MB) to Supabase Storage..."));let{error:t}=await c.storage.from("park-uploads").upload(e,U,{cacheControl:"3600",upsert:!1});if(t){if(t.message.includes("Bucket not found")||t.message.includes("not found"))return void B('Storage bucket "park-uploads" not found. Please create it in Supabase Dashboard > Storage.');throw t}let{data:i}=c.storage.from("park-uploads").getPublicUrl(e),r=i.publicUrl;console.log("File uploaded to storage, processing...");let a=new FormData;a.append("fileUrl",r),a.append("sourceType",q),a.append("sourceName",U.name),a.append("filePath",e);let l=new AbortController,n=setTimeout(()=>l.abort(),3e5),o=await fetch("/api/upload",{method:"POST",body:a,signal:l.signal});if(clearTimeout(n),!o.ok){let e="Upload failed with status ".concat(o.status);try{e=(await o.json()).error||e}catch(s){e=o.statusText||e}B(e);return}let d=await o.json();if(d.success){z(d),E(null);let e=document.querySelector('input[type="file"]');e&&(e.value="")}else if(B(d.error||"Upload failed"),e)try{await c.storage.from("park-uploads").remove([e])}catch(e){console.warn("Failed to cleanup storage file on error:",e)}}catch(s){if(console.error("Upload error:",s),e)try{await c.storage.from("park-uploads").remove([e])}catch(e){console.warn("Failed to cleanup storage file on error:",e)}"AbortError"===s.name?B("Upload timed out after 5 minutes. The file may be too large. Please try splitting it into smaller files or contact support."):B("Network error: ".concat(s.message,". Please check your connection and try again."))}finally{L(!1)}};return(0,i.jsxs)("div",{className:"admin-panel",children:[(0,i.jsxs)("div",{className:"admin-header",children:[(0,i.jsx)("h1",{children:"\uD83C\uDFDE️ Outside Insiders Admin Panel"}),(0,i.jsx)("p",{children:"Manage park data sources"})]}),(0,i.jsxs)("div",{className:"tab-navigation",children:[(0,i.jsx)("button",{className:"tab ".concat("scraper"===e?"active":""),onClick:()=>s("scraper"),children:"\uD83C\uDF10 Web Scraper"}),(0,i.jsx)("button",{className:"tab ".concat("api"===e?"active":""),onClick:()=>s("api"),children:"\uD83D\uDD0C API Manager"}),(0,i.jsx)("button",{className:"tab ".concat("upload"===e?"active":""),onClick:()=>s("upload"),children:"\uD83D\uDCC1 File Upload"})]}),(0,i.jsxs)("div",{className:"tab-content",children:["scraper"===e&&(0,i.jsxs)("div",{className:"section",children:[(0,i.jsx)("h2",{children:"Web Scraper"}),(0,i.jsx)("p",{className:"section-description",children:"Scrape park data from websites. Priority: 40 (can't overwrite API or file data)"}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"1️⃣ Select State:"}),(0,i.jsxs)("select",{value:g,onChange:e=>{let s=t.find(s=>s.name===e.target.value);Z(e.target.value,null==s?void 0:s.state_code)},disabled:N||h,children:[(0,i.jsx)("option",{value:"",children:"-- Select a State --"}),t.map(e=>(0,i.jsxs)("option",{value:e.name,children:[e.name," (",e.state_code,")"]},e.id))]})]}),g&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"2️⃣ What to Scrape:"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,i.jsxs)("label",{style:{cursor:"pointer",padding:"5px"},children:[(0,i.jsx)("input",{type:"radio",value:"state",checked:"state"===k,onChange:e=>Q(e.target.value),disabled:N}),(0,i.jsxs)("span",{style:{marginLeft:"8px"},children:[(0,i.jsx)("strong",{children:"State Parks"})," - All state parks in ",g]})]}),(0,i.jsxs)("label",{style:{cursor:"pointer",padding:"5px",background:"#e8f4f8"},children:[(0,i.jsx)("input",{type:"radio",value:"metro",checked:"metro"===k,onChange:e=>Q(e.target.value),disabled:N}),(0,i.jsxs)("span",{style:{marginLeft:"8px"},children:[(0,i.jsx)("strong",{children:"Metro Area"})," - All counties + cities in a metro (bulk)"]})]}),(0,i.jsxs)("label",{style:{cursor:"pointer",padding:"5px"},children:[(0,i.jsx)("input",{type:"radio",value:"county",checked:"county"===k,onChange:e=>Q(e.target.value),disabled:N}),(0,i.jsxs)("span",{style:{marginLeft:"8px"},children:[(0,i.jsx)("strong",{children:"Single County"})," - One specific county"]})]}),(0,i.jsxs)("label",{style:{cursor:"pointer",padding:"5px"},children:[(0,i.jsx)("input",{type:"radio",value:"city",checked:"city"===k,onChange:e=>Q(e.target.value),disabled:N}),(0,i.jsxs)("span",{style:{marginLeft:"8px"},children:[(0,i.jsx)("strong",{children:"Single City"})," - One specific city"]})]})]})]}),"metro"===k&&g&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"3️⃣ Select Metro Area:"}),(0,i.jsxs)("select",{value:j,onChange:e=>K(e.target.value),disabled:N||0===l.length,children:[(0,i.jsx)("option",{value:"",children:"-- Select a Metro Area --"}),l.map(e=>(0,i.jsx)("option",{value:e.name,children:e.name},e.id))]}),j&&T&&(0,i.jsxs)("div",{style:{marginTop:"10px",padding:"10px",background:"#f0f7ed",borderRadius:"5px"},children:[(0,i.jsx)("strong",{children:"This metro includes:"}),(0,i.jsxs)("ul",{style:{margin:"5px 0"},children:[(0,i.jsxs)("li",{children:[T.counties," counties"]}),(0,i.jsxs)("li",{children:[T.cities," cities"]}),(0,i.jsx)("li",{children:(0,i.jsxs)("strong",{children:["Total: ",T.counties+T.cities," entities to scrape"]})})]})]})]}),"county"===k&&g&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"3️⃣ Select County:"}),(0,i.jsxs)("select",{value:f,onChange:e=>v(e.target.value),disabled:N||0===o.length,children:[(0,i.jsx)("option",{value:"",children:"-- Select a County --"}),o.map(e=>(0,i.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),"city"===k&&g&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"3️⃣ Select City:"}),(0,i.jsxs)("select",{value:S,onChange:e=>b(e.target.value),disabled:N||0===p.length,children:[(0,i.jsx)("option",{value:"",children:"-- Select a City --"}),p.map(e=>(0,i.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,i.jsx)("button",{onClick:Y,disabled:N||!g||"metro"===k&&!j||"county"===k&&!f||"city"===k&&!S,className:"primary-button",style:{marginTop:"20px"},children:N?"\uD83D\uDD04 Scraping...":"\uD83D\uDE80 Start Scrape"}),g&&(0,i.jsxs)("div",{style:{marginTop:"10px",padding:"15px",background:"#f8f9fa",borderRadius:"5px"},children:[(0,i.jsx)("strong",{children:"Ready to scrape:"}),"state"===k&&(0,i.jsxs)("p",{children:["All state parks in ",g]}),"metro"===k&&j&&(0,i.jsxs)("p",{children:[T.counties+T.cities," locations in ",j]}),"county"===k&&f&&(0,i.jsxs)("p",{children:["County parks in ",f,", ",g]}),"city"===k&&S&&(0,i.jsxs)("p",{children:["City parks in ",S,", ",g]})]}),w&&(0,i.jsxs)("div",{className:"alert alert-error",children:["❌ ",w]}),A&&(0,i.jsxs)("div",{className:"alert alert-success",children:["✅ Success! ",A.message,void 0!==A.parksFound&&(0,i.jsxs)("div",{className:"result-details",children:[(0,i.jsxs)("p",{children:["Parks found: ",A.parksFound]}),(0,i.jsxs)("p",{children:["Parks added: ",A.parksAdded||0]}),(0,i.jsxs)("p",{children:["Parks updated: ",A.parksUpdated||0]}),(0,i.jsxs)("p",{children:["Parks skipped (protected): ",A.parksSkipped||0]})]})]}),(0,i.jsxs)("div",{style:{marginTop:"30px",padding:"20px",background:"#e8f4f8",borderRadius:"8px"},children:[(0,i.jsx)("h4",{children:"\uD83D\uDCCA Geographic Data Summary:"}),(0,i.jsxs)("ul",{style:{lineHeight:"1.8"},children:[(0,i.jsxs)("li",{children:["Total States: ",t.length]}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("li",{children:["Metros in ",g,": ",l.length]}),(0,i.jsxs)("li",{children:["Counties in ",g,": ",o.length]}),(0,i.jsxs)("li",{children:["Cities in ",g,": ",p.length]})]})]})]}),(0,i.jsxs)("div",{style:{marginTop:"20px",padding:"20px",background:"#f0f7ed",borderRadius:"8px"},children:[(0,i.jsx)("h4",{children:"\uD83C\uDFAF Data Protection System:"}),(0,i.jsxs)("ul",{style:{lineHeight:"1.8"},children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Quality Score:"})," 0-100 points based on completeness"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Priority:"})," API (100) → Files (80) → Scrapes (40)"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Protection:"})," High-quality data never overwritten"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Updates:"})," Only if quality improves"]})]})]})]}),"api"===e&&(0,i.jsxs)("div",{className:"section",children:[(0,i.jsx)("h2",{children:"API Manager"}),(0,i.jsx)("p",{className:"section-description",children:"Connect to official park APIs. Priority: 90-100 (highest protection)"}),(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("p",{children:"API integration coming soon!"}),(0,i.jsxs)("ul",{style:{textAlign:"left",display:"inline-block",marginTop:"10px"},children:[(0,i.jsx)("li",{children:"NPS API (Priority: 100)"}),(0,i.jsx)("li",{children:"Recreation.gov API (Priority: 95)"}),(0,i.jsx)("li",{children:"State Park APIs (Priority: 90)"})]})]})]}),"upload"===e&&(0,i.jsxs)("div",{className:"section",children:[(0,i.jsx)("h2",{children:"File Upload"}),(0,i.jsx)("p",{className:"section-description",children:"Upload GeoJSON or Shapefile files. Priority: 80 (protected from scrapes). Files will be intelligently merged with existing data. Large files may take several minutes to process."}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"1️⃣ Select Source Type:"}),(0,i.jsxs)("select",{value:q,onChange:e=>I(e.target.value),disabled:O,children:[(0,i.jsx)("option",{value:"Public Federal",children:"Public Federal"}),(0,i.jsx)("option",{value:"Public State",children:"Public State"}),(0,i.jsx)("option",{value:"State Agency",children:"State Agency"}),(0,i.jsx)("option",{value:"County Agency",children:"County Agency"}),(0,i.jsx)("option",{value:"City Agency",children:"City Agency"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"2️⃣ Select File (GeoJSON, Shapefile, or ZIP):"}),(0,i.jsx)("input",{type:"file",accept:".geojson,.json,.shp,.zip",onChange:e=>{var s;E(null==(s=e.target.files)?void 0:s[0]),B(null),z(null)},disabled:O}),U&&(0,i.jsxs)("p",{style:{marginTop:"10px",color:"#666"},children:["Selected: ",(0,i.jsx)("strong",{children:U.name})," (",(U.size/1024/1024).toFixed(2)," MB)",U.size>0x3200000&&(0,i.jsx)("span",{style:{color:"#ff6b6b",marginLeft:"10px"},children:"⚠️ Large file - processing may take several minutes"})]}),(0,i.jsxs)("p",{style:{marginTop:"10px",fontSize:"0.9rem",color:"#666"},children:[(0,i.jsx)("strong",{children:"Supported formats:"})," GeoJSON (.geojson, .json), Shapefile (.shp), or ZIP archives containing shapefiles (.zip)"]})]}),(0,i.jsx)("div",{className:"form-group",children:(0,i.jsx)("button",{onClick:V,disabled:!U||O,className:"primary-button",children:O?"⏳ Uploading...":"\uD83D\uDCE4 Upload File"})}),R&&(0,i.jsxs)("div",{className:"error-message",style:{marginTop:"20px"},children:[(0,i.jsx)("strong",{children:"Error:"})," ",R]}),M&&(0,i.jsxs)("div",{className:"success-message",style:{marginTop:"20px",padding:"20px",background:"#f0f7ed",borderRadius:"8px"},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"✅ Upload Complete!"}),(0,i.jsxs)("ul",{style:{textAlign:"left",display:"inline-block"},children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"File:"})," ",M.sourceName]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Source Type:"})," ",M.sourceType]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Parks Found:"})," ",M.parksFound]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Parks Added:"})," ",M.parksAdded]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Parks Updated:"})," ",M.parksUpdated]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Parks Skipped:"})," ",M.parksSkipped]})]}),M.errors&&M.errors.length>0&&(0,i.jsxs)("div",{style:{marginTop:"10px"},children:[(0,i.jsx)("strong",{children:"Errors:"}),(0,i.jsx)("ul",{style:{textAlign:"left"},children:M.errors.map((e,s)=>(0,i.jsxs)("li",{children:[e.park,": ",e.error]},s))})]})]})]})]}),(0,i.jsxs)("div",{className:"admin-footer",children:[(0,i.jsx)("h4",{children:"\uD83D\uDEE1️ Data Priority System"}),(0,i.jsxs)("div",{className:"priority-info",children:[(0,i.jsxs)("div",{className:"priority-item",children:[(0,i.jsx)("span",{className:"priority-badge priority-100",children:"100"}),(0,i.jsx)("span",{children:"API Data - Never overwritten"})]}),(0,i.jsxs)("div",{className:"priority-item",children:[(0,i.jsx)("span",{className:"priority-badge priority-80",children:"80"}),(0,i.jsx)("span",{children:"Agency Files - Protected"})]}),(0,i.jsxs)("div",{className:"priority-item",children:[(0,i.jsx)("span",{className:"priority-badge priority-40",children:"40"}),(0,i.jsx)("span",{children:"Web Scrapes - Fills gaps"})]})]})]})]})}},4635:(e,s,t)=>{Promise.resolve().then(t.bind(t,4180))},6255:()=>{}},e=>{e.O(0,[332,993,441,255,358],()=>e(e.s=4635)),_N_E=e.O()}]);
(()=>{var a={};a.id=778,a.ids=[778],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},716:()=>{},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:a=>{"use strict";a.exports=require("http")},1929:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>H,patchFetch:()=>G,routeModule:()=>C,serverHooks:()=>F,workAsyncStorage:()=>D,workUnitAsyncStorage:()=>E});var d={};c.r(d),c.d(d,{DELETE:()=>A,GET:()=>z,OPTIONS:()=>B,dynamic:()=>x,runtime:()=>y});var e=c(5736),f=c(9117),g=c(4044),h=c(9326),i=c(2324),j=c(261),k=c(4290),l=c(5328),m=c(8928),n=c(6595),o=c(3421),p=c(7679),q=c(1681),r=c(3446),s=c(6439),t=c(1356),u=c(6931);let v=["office","offices","headquarters","hq","admin","administration","facility","facilities","service center","service center","city hall","county office","county building","municipal building","government center","courthouse","courthouse annex","maintenance","maintenance facility","equipment yard","warehouse","storage","depot"];function w(a){if(!a)return 0;let b=0;return a.name&&"Unnamed Park"!==a.name&&(b+=10),a.state&&(b+=10),a.agency&&(b+=10),a.latitude&&a.longitude&&(b+=10),a.description&&a.description.trim().length>0&&(b+=10),a.website&&(b+=5),a.phone&&(b+=5),a.address&&(b+=5),a.acres&&a.acres>0&&(b+=5),a.geometry&&(b+=10),a.email&&(b+=3),a.county&&(b+=2),a.amenities&&Array.isArray(a.amenities)&&a.amenities.length>0&&(b+=5),a.activities&&Array.isArray(a.activities)&&a.activities.length>0&&(b+=5),a.category&&(b+=2),a.public_access&&(b+=3),Math.min(b,100)}let x="force-dynamic",y="nodejs";async function z(a){let b={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,OPTIONS","Access-Control-Allow-Headers":"Content-Type"};try{let{searchParams:c}=new URL(a.url),d=c.get("state"),e=c.get("agency"),f=c.get("data_source"),g=c.get("action");if(!u.w)return Response.json({success:!1,error:"Database not initialized",details:"Supabase client is not available. Please check environment variables."},{status:500,headers:b});let h=u.w.from("parks").select("*");d&&(h=h.eq("state",d)),e&&(h=h.eq("agency",e)),f&&(h=h.eq("data_source",f));let{data:i,error:j}=await h;if(j)return Response.json({success:!1,error:"Failed to fetch parks",details:j.message},{status:500,headers:b});if(!i||0===i.length)return Response.json({success:!0,analysis:{total:0,message:"No parks found matching criteria"}},{status:200,headers:b});let k=function(a){let b={total:a.length,withCoordinates:0,withDescription:0,withWebsite:0,withPhone:0,withAddress:0,withGeometry:0,averageQualityScore:0,qualityDistribution:{excellent:0,good:0,fair:0,poor:0},likelyNonParks:[],missingFields:{description:0,website:0,phone:0,address:0,geometry:0,coordinates:0},issues:[]},c=0;for(let d of a){d.latitude&&d.longitude&&b.withCoordinates++,d.description&&d.description.trim()&&b.withDescription++,d.website&&b.withWebsite++,d.phone&&b.withPhone++,d.address&&b.withAddress++,d.geometry&&b.withGeometry++,(!d.description||!d.description.trim())&&b.missingFields.description++,!d.website&&b.missingFields.website++,!d.phone&&b.missingFields.phone++,!d.address&&b.missingFields.address++,!d.geometry&&b.missingFields.geometry++,(!d.latitude||!d.longitude)&&b.missingFields.coordinates++;let a=w(d);c+=a,a>=80?b.qualityDistribution.excellent++:a>=60?b.qualityDistribution.good++:a>=40?b.qualityDistribution.fair++:b.qualityDistribution.poor++;let e=function(a){if(!a||!a.name)return!1;let b=a.name.toLowerCase();for(let a of v)if(b.includes(a))return{isNonPark:!0,reason:`Name contains "${a}"`,confidence:"high"};if(a.acres&&a.acres<.1)return{isNonPark:!0,reason:`Very small size (${a.acres} acres) - likely office/facility`,confidence:"medium"};for(let b of[/county\s+office/i,/city\s+hall/i,/municipal\s+building/i,/government\s+center/i,/service\s+center/i,/\badmin\b/i,/\bfacility\b/i])if(b.test(a.name))return{isNonPark:!0,reason:"Name matches non-park pattern",confidence:"high"};return{isNonPark:!1,reason:null,confidence:null}}(d);e.isNonPark&&b.likelyNonParks.push({id:d.id,name:d.name,state:d.state,agency:d.agency,reason:e.reason,confidence:e.confidence,acres:d.acres});let f=[];d.latitude&&d.longitude||f.push("Missing coordinates"),d.description&&d.description.trim()||f.push("Missing description"),d.geometry||f.push("Missing boundary geometry"),d.acres&&d.acres<.1&&f.push("Very small size (< 0.1 acres)"),a<40&&f.push("Low quality score"),f.length>0&&b.issues.push({id:d.id,name:d.name,state:d.state,agency:d.agency,score:a,issues:f})}return b.averageQualityScore=b.total>0?Math.round(c/b.total*100)/100:0,b.percentages={withCoordinates:b.total>0?Math.round(b.withCoordinates/b.total*100):0,withDescription:b.total>0?Math.round(b.withDescription/b.total*100):0,withWebsite:b.total>0?Math.round(b.withWebsite/b.total*100):0,withPhone:b.total>0?Math.round(b.withPhone/b.total*100):0,withAddress:b.total>0?Math.round(b.withAddress/b.total*100):0,withGeometry:b.total>0?Math.round(b.withGeometry/b.total*100):0},b}(i);if("breakdown"===g){let a=c.get("groupBy")||"agency";if("true"===c.get("matrix")){let d=c.get("fields")?.split(",")||["name","description","website","phone","address"],e=function(a,b="agency",c=["name","description","website","phone","address"]){if(!a||0===a.length)return{rows:[],columns:c,matrix:{}};let d=new Map,e={},f=(a,b)=>{switch(b){case"name":return a.name&&"Unnamed Park"!==a.name?100:0;case"description":return a.description&&a.description.trim().length>0?100:0;case"website":return 100*!!a.website;case"phone":return 100*!!a.phone;case"address":return 100*!!a.address;case"coordinates":return a.latitude&&a.longitude?100:0;case"geometry":return 100*!!a.geometry;case"acres":return a.acres&&a.acres>0?100:0;default:return 100*!!a[b]}};for(let g of a){let a=null;switch(b){case"agency":a=g.agency||"Unknown";break;case"state":a=g.state||"Unknown";break;case"city":a=g.city||"Unknown";break;case"county":a=g.county||"Unknown";break;case"category":a=g.category||g.designation_type||"Unknown";break;default:a=g[b]||"Unknown"}if(!d.has(a))for(let b of(d.set(a,[]),e[a]={},c))e[a][b]={total:0,count:0};for(let b of(d.get(a).push(g),c)){let c=f(g,b);e[a][b].total+=c,e[a][b].count+=1}}let g=Array.from(d.keys()).sort(),h={};for(let a of g)for(let b of(h[a]={},c)){let{total:c,count:d}=e[a][b];h[a][b]=d>0?Math.round(c/d*100)/100:0}return{rows:g,columns:c,matrix:h}}(i,a,d);return Response.json({success:!0,matrix:e,groupBy:a,total:i.length},{status:200,headers:b})}{let c=function(a,b="agency"){if(!a||0===a.length)return[];let c=new Map;for(let d of a){let a=null;switch(b){case"agency":a=d.agency||"Unknown";break;case"state":a=d.state||"Unknown";break;case"city":a=d.city||"Unknown";break;case"county":a=d.county||"Unknown";break;case"category":a=d.category||d.designation_type||"Unknown";break;default:a=d[b]||"Unknown"}c.has(a)||c.set(a,{group:a,count:0,totalScore:0,withCoordinates:0,withDescription:0,withWebsite:0,withPhone:0,withAddress:0,withGeometry:0,missingFields:{description:0,website:0,phone:0,address:0,geometry:0,coordinates:0}});let e=c.get(a);e.count++;let f=w(d);e.totalScore+=f,d.latitude&&d.longitude&&e.withCoordinates++,d.description&&d.description.trim()&&e.withDescription++,d.website&&e.withWebsite++,d.phone&&e.withPhone++,d.address&&e.withAddress++,d.geometry&&e.withGeometry++,(!d.description||!d.description.trim())&&e.missingFields.description++,!d.website&&e.missingFields.website++,!d.phone&&e.missingFields.phone++,!d.address&&e.missingFields.address++,!d.geometry&&e.missingFields.geometry++,(!d.latitude||!d.longitude)&&e.missingFields.coordinates++}let d=Array.from(c.values()).map(a=>{let b=a.count>0?Math.round(a.totalScore/a.count*100)/100:0;return{group:a.group,count:a.count,averageScore:b,completeness:{coordinates:a.count>0?Math.round(a.withCoordinates/a.count*100):0,description:a.count>0?Math.round(a.withDescription/a.count*100):0,website:a.count>0?Math.round(a.withWebsite/a.count*100):0,phone:a.count>0?Math.round(a.withPhone/a.count*100):0,address:a.count>0?Math.round(a.withAddress/a.count*100):0,geometry:a.count>0?Math.round(a.withGeometry/a.count*100):0},missingFields:a.missingFields,weakFields:Object.entries(a.missingFields).filter(([,b])=>b>0&&b/a.count>.5).map(([a])=>a)}});return d.sort((a,b)=>a.averageScore-b.averageScore),d}(i,a);return Response.json({success:!0,breakdown:c,groupBy:a,total:i.length},{status:200,headers:b})}}if("filter"===g){let a={nameKeywords:c.get("nameKeywords")?.split(",").filter(Boolean),state:c.get("filterState")||null,agency:c.get("filterAgency")||null,maxAcres:c.get("maxAcres")?parseFloat(c.get("maxAcres")):void 0,minAcres:c.get("minAcres")?parseFloat(c.get("minAcres")):void 0,maxQualityScore:c.get("maxQualityScore")?parseInt(c.get("maxQualityScore")):void 0,missingFields:c.get("missingFields")?.split(",").filter(Boolean)},d=a.nameKeywords?.length>0||void 0!==a.maxAcres||void 0!==a.minAcres||void 0!==a.maxQualityScore||a.missingFields?.length>0?i.filter(b=>{if(a.nameKeywords&&a.nameKeywords.length>0){let c=b.name?.toLowerCase()||"";if(!a.nameKeywords.some(a=>c.includes(a.toLowerCase())))return!1}return!(a.state&&b.state!==a.state||a.agency&&b.agency!==a.agency||void 0!==a.maxAcres&&b.acres&&b.acres>a.maxAcres||void 0!==a.minAcres&&b.acres&&b.acres<a.minAcres||void 0!==a.maxQualityScore&&w(b)>a.maxQualityScore)&&(!a.missingFields||!(a.missingFields.length>0)||!!a.missingFields.every(a=>"coordinates"===a?!b.latitude||!b.longitude:"geometry"===a?!b.geometry:!b[a]))&&!0}):i;return Response.json({success:!0,analysis:k,filteredParks:d.map(a=>({id:a.id,name:a.name,state:a.state,agency:a.agency,county:a.county||null,acres:a.acres?parseFloat(a.acres):null,qualityScore:w(a)})),filterCriteria:a},{status:200,headers:b})}return Response.json({success:!0,analysis:k},{status:200,headers:b})}catch(a){return console.error("Data quality API error:",a),Response.json({success:!1,error:"Internal server error",message:a.message},{status:500,headers:b})}}async function A(a){let b={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type"};try{let{parkIds:c}=await a.json().catch(()=>({}));if(!c||!Array.isArray(c)||0===c.length)return Response.json({success:!1,error:"parkIds array is required"},{status:400,headers:b});let{error:d}=await u.w.from("parks").delete().in("id",c);if(d)return Response.json({success:!1,error:"Failed to delete parks",details:d.message},{status:500,headers:b});return Response.json({success:!0,deleted:c.length,message:`Successfully deleted ${c.length} park(s)`},{status:200,headers:b})}catch(a){return console.error("Delete parks error:",a),Response.json({success:!1,error:"Internal server error",message:a.message},{status:500,headers:b})}}async function B(){return new Response(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let C=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/admin/data-quality/route",pathname:"/api/admin/data-quality",filename:"route",bundlePath:"app/api/admin/data-quality/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/robertfleming/outside-insiders-current/app/api/admin/data-quality/route.js",nextConfigOutput:"",userland:d}),{workAsyncStorage:D,workUnitAsyncStorage:E,serverHooks:F}=C;function G(){return(0,g.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:E})}async function H(a,b,c){var d;let e="/api/admin/data-quality/route";"/index"===e&&(e="/");let g=await C.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[D]);if(F&&!x){let a=!!y.routes[D],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||C.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===C.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>C.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>C.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await C.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await C.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await C.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},1997:a=>{"use strict";a.exports=require("punycode")},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4075:a=>{"use strict";a.exports=require("zlib")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5591:a=>{"use strict";a.exports=require("https")},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},6931:(a,b,c)=>{"use strict";c.d(b,{L:()=>h,w:()=>g});var d=c(3672);let e=process.env.NEXT_PUBLIC_SUPABASE_URL||"",f=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",g=e&&f?(0,d.UU)(e,f):null;function h(){return null!==g}},7910:a=>{"use strict";a.exports=require("stream")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:a=>{"use strict";a.exports=require("url")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[873,505],()=>b(b.s=1929));module.exports=c})();